<!doctype html>

<head>
<meta charset="utf-8">
<script src="lib/d3.v3.min.js"></script>
<script src="lib/d3.geo.tile.v0.min.js"></script>

<style>

body {
  margin: 0;
}

path {
  fill: none;
  stroke-linejoin: round;
  stroke-width: 1.5px;
}

.gridbucket {
  stroke: gray;
}

.islas {
  stroke: red;
}

.inactive {
  visibility: hidden;
}

</style>

</head>

<body>

<script>

var body = d3.select('body');

function showLoad (err, data) {
  if (err) return console.log(err);
  console.log(data);
}

var width = Math.max(960, window.innerWidth),
    height = Math.max(500, window.innerHeight);

var tile = d3.geo.tile()
    .size([width, height]);

var projection = d3.geo.mercator()
  .scale((1 << 18))
  .translate([width / 2, height / 2]);

var path = d3.geo.path()
  .projection(projection)

var svg = body.append("svg")
  .attr("width", width)
  .attr("height", height);

var colScale = d3.scale.category20c()

var vector = svg.append("g");

var islandsLoaded = false;

function showIslands (data) {
  console.log(data);
  if (!(islandsLoaded)) {
    requestIslands();
    return;
  }
  projection.center([-122.441884929543,37.7550733441484])
  vector.append('path').attr('d', function () { return path(data) })
  .attr('stroke-dasharray',"2, 5")
  .classed('islas', true)
}

d3.json('data/sf_filled_grid.geojson', function (err, data) {
  console.log(data);
  if (err) return console.log(err);
  projection.center([-122.441884929543,37.7550733441484])
  vector.selectAll('g').data(data['features'])
  .enter().append('g').append('path').attr('d', function (d) { return path(d); })
  .attr('stroke-dasharray',"2, 5")
  .classed('gridbucket', true)
  .style('fill', function (d, i) { return colScale(i%20); })
  .on('click', showIslands)
});

function requestIslands() {
  d3.json('data/islands_sf.geojson', function (err, data) {
    islandsLoaded = true;
    showIslands(data);
  })
}

</script>
